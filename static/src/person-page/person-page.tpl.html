<div ng-show="profileStatus=='no_email'" class="page person-incomplete set-email">
    <h2>Set email</h2>
    <p class="instructions">
        Almost ready! We just need your email so we can send you updates when
        we find new online attention for your research (we won't use this email for
        spam or product offers).
    </p>
    <div class="setting-email" ng-show="settingEmail"></div>
    <form ng-show="!settingEmail" class="user-input" ng-submit="submitEmail()">
        <div class="form-group">
            <label for="user-email">Email address</label>
            <input ng-model="userForm.email"
                   type="email"
                   class="form-control input-lg"
                   id="user-email"
                   required
                   placeholder="Email">
        </div>
        <button type="submit" class="btn btn-primary btn-lg">Make my profile!</button>
    </form>

</div>

<div ng-show="profileStatus=='no_products'" class="page person-incomplete add-products">
    <h2>Add products</h2>

</div>

<div ng-show="profileStatus=='all_good'" class="page person">

    <div class="person-header row">
        <div class="col-md-9 person-about">
            <div class="content">
                <div class="avatar">
                    <img ng-src="{{ person.picture }}" alt=""/>
                </div>

                <div class="bio">
                    <h2 class="name">
                       {{ person.given_names }} {{ person.family_name }}
                        <span class="accounts">
                            <a href="http://orcid.org/{{ person.orcid_id }}">
                                <img src="static/img/favicons/orcid.ico" alt="">
                            </a>
                            <a href="http://depsy.org/{{ person.depsy_id }}"
                                    ng-show="person.depsy_id">
                                <img src="static/img/favicons/depsy.png" alt="">
                            </a>
                            <a href="http://twitter.com/{{ person.twitter }}"
                               ng-show="person.twitter"
                               class="twitter">
                                <img src="static/img/favicons/twitter.ico" alt="">
                            </a>
                        </span>
                    </h2>
                    <div class="aff">
                        <span class="institution">{{ person.affiliation_name }}</span>
                        <span class="role">
                            {{ person.affiliation_role_title }}
                        </span>
                    </div>

                    <div class="person-score {{ person.belt }}belt" ng-click="beltModal()">
                        <!--<img src="static/img/favicon.ico" alt="">-->
                        <i class="fa fa-bar-chart"></i>
                        <span class="val">
                            <span class="score-value">
                                {{ numFormat.short(person.score) }}
                            </span>
                        </span>
                        <span class="score-belt">
                            <span class="descr">online impact score</span>
                        </span>

                    </div>
                    <div class="autogenerated" ng-show="!person.claimed_at">
                        <p>
                            This profile has been <a href="about/orcid">automatically generated;</a> log in to update or delete.
                        </p>
                        <!--
                        <p>
                            you can log in to update, modify, or delete it.
                        </p>
                        -->
                        <p>
                            <span class="btn btn-default btn-xs" ng-click="authenticate()">Login with ORCID</span>
                        </p>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-3 person-actions"></div>
    </div>


    <div class="tab-controls row">
        <a class="tab overview selected-{{ tab=='overview' }}" href="/u/{{ person.orcid_id }}">overview</a>
        <a class="tab publications selected-{{ tab=='publications' }}" href="/u/{{ person.orcid_id }}/publications">publications</a>
        <a class="tab publications selected-{{ tab=='achievements' }}" href="/u/{{ person.orcid_id }}/achievements">achievements</a>
        <a class="tab publications selected-{{ tab=='mentions' }}" href="/u/{{ person.orcid_id }}/mentions">mentions</a>
    </div>



    <!-- OVERVIEW view -->
    <div class="tab-view overview row" ng-if="tab=='overview'">
        <div class="col-md-4 publications-col">
            <h3>Top publications</h3>
            <div class="publication-wrapper"
                 ng-include="'publication-item.tpl.html'"
                 ng-repeat="product in products | orderBy: '-altmetric_score' | limitTo: 3">
            </div>
        </div>
        <div class="col-md-4 badges-col">
            <h3>Top achievements</h3>
            <div class="badges-wrapper"
                 ng-include="'badge-item.tpl.html'"
                 ng-repeat="badge in badges | orderBy: '-sort_score' | limitTo: 3">
            </div>
        </div>
        <div class="col-md-4 mentions-col">
            <div class="channels-list-wrapper" ng-include="'channels-list.tpl.html'"></div>
        </div>
    </div>


    <!-- PUBLICATIONS view -->
    <div class="tab-view publications row" ng-if="tab=='publications'">
        <div class="col-md-8 publications-col main-col">
            <p class="hedge">We found online attention on</p>
            <h3>
                {{ selectedGenre.count || products.length }} publications
                <span class="filter" ng-if="selectedGenre">
                    <span class="filter-intro">that are</span>
                    <span class="label label-default">
                        <span class="content">
                            <i class="fa fa-{{ getGenreIcon(selectedGenre.name) }}"></i>
                            {{ pluralize(selectedGenre.name) }}
                        </span>
                        <span class="close-button" ng-click="toggleSeletedGenre(undefined)">&times;</span>
                    </span>
                </span>
            </h3>
            <div class="publication-wrapper"
                 ng-include="'publication-item.tpl.html'"
                 ng-repeat="product in products | orderBy: '-altmetric_score' | filter: {genre: selectedGenre.name}">
            </div>
        </div>
        <div class="col-md-4 badges-col small-col">

            <div class="filter-by-genre" ng-show="genres.length > 1">
                <h4>Filter by genre</h4>

                <div class="genre-filter filter-option"
                     ng-repeat="genre in genres"
                     ng-class="{ unselected: selectedGenre && selectedGenre.name != genre.name, selected: selectedGenre.name == genre.name }">
                    <span class="close-button" ng-click="toggleSeletedGenre(undefined)">&times;</span>
                    <span class="content" ng-click="toggleSeletedGenre(genre)">
                        <span class="name">
                            <i class="fa fa-{{ getGenreIcon(genre.name) }}"></i>
                            {{ pluralize(genre.name, genre.count) }}
                        </span>
                        <span class="val">({{ genre.count }})</span>
                    </span>

                </div>
            </div>



            <h4>Coauthors</h4>
            <div class="coauthor" ng-repeat="coauthor in person.coauthors | orderBy: '-altmetric_score'">
                <a href="u/{{ coauthor.orcid_id }}">
                    <span class="score">
                        {{ numFormat.short(coauthor.score) }}
                    </span>
                    <span class="name">
                        {{ coauthor.name }}
                    </span>
                </a>
            </div>
        </div>
    </div>




    <!-- BADGES view -->
    <div class="tab-view badges row" ng-if="tab=='achievements'">
        <div class="col-md-8 main-col">
            <h3>
                <span ng-show="filteredBadges.length" class="amount">{{ filteredBadges.length }}</span>
                <span ng-show="!filteredBadges.length" class="amount">No</span>
                achievement<span ng-hide="filteredBadges.length===1">s</span>
                <span ng-show="filteredBadges.length===0" class="yet">yet</span>

                <span class="filter" ng-if="selectedSubscore">
                    <span class="filter-intro">in</span>
                    <span class="filter label label-default {{ selectedSubscore.name }}">
                        <span class="content">
                            <i class="fa fa-{{ getBadgeIcon(selectedSubscore.name) }}"></i>
                            {{ selectedSubscore.display_name }}
                        </span>
                        <span class="close-button" ng-click="toggleSeletedSubscore(undefined)">&times;</span>
                    </span>
                </span>
            </h3>

            <div class="subscore-info" ng-show="selectedSubscore">

                <!-- the individual subscores -->
                <subscorehelp name="selectedSubscore.name"></subscorehelp>

                <!-- for all subscores -->
                <div class="personalized">
                    <p>
                        For {{ person.given_names }} that's
                        <span class="subscore {{ selectedSubscore.name }}">{{ numFormat.short(selectedSubscore.score) }}</span>,
                        which is better than {{ numFormat.short(selectedSubscore.perc * 100) }}% of other researchers.
                        Given the <span class="name">{{ selectedSubscore.display_name }}</span> subscore's weight of {{ selectedSubscore.weight }}, it adds
                        <span>{{ numFormat.short(selectedSubscore.contribution) }}</span> to {{ person.given_names }}'s overall score.
                    </p>
                    <p ng-show="filteredBadges.length">
                        {{ person.given_names }} also has {{ filteredBadges.length }}
                        achievement<span ng-hide="filteredBadges.length===1">s</span> in the
                        {{ subscore.display_name }} category:
                    </p>
                    <p ng-show="!filteredBadges.length">
                        {{ person.given_name }} doesn't have any achievements in the
                        {{ subscore.display_name }} category yet.
                    </p>
                </div>
            </div>



            <div class="badges-wrapper"
                 ng-class=""
                 ng-include="'badge-item.tpl.html'"
                 ng-repeat="badge in badges | orderBy: '-sort_score' | filter: {group: selectedSubscore.name} as filteredBadges">
            </div>
        </div>
        <div class="col-md-4 small-col">
            <h4>Scores</h4>
            <table class="subscores">
                <tr class="subscore {{ subscore.name }}"
                    ng-class="{ unselected: selectedSubscore && selectedSubscore.name != subscore.name, selected: selectedSubscore.name == subscore.name }"
                    ng-click="toggleSeletedSubscore(subscore)"
                    ng-repeat="subscore in person.subscores | orderBy: '-contribution'">
                    <td class="close-button">&times;</td>
                    <td class="icon">
                        <i class="fa fa-{{ getBadgeIcon(subscore.name) }}"></i>
                    </td>
                    <td class="name">
                        {{ subscore.display_name }}
                    </td>
                    <td class="val">
                        <span class="plusminus" ng-show="subscore.score >= 0 && !$first">+</span>
                        <span class="plusminus" ng-show="subscore.score < 0">-</span>
                        <span class="number">{{ numFormat.short(subscore.contribution) }}</span>
                    </td>
                    <td class="goodness">
                        {{ subscore.goodness }}
                    </td>

                </tr>
            </table>
        </div>
    </div>


    <!-- MENTIONS view -->
    <div class="tab-view mentions row" ng-if="tab=='mentions'">
        <div class="col-md-8 posts-col main-col">
            <h3>
                {{ selectedChannel.posts_count || postsSum }} mentions
                <span class="no-filter" ng-if="!selectedChannel">online</span>
                <span class="filter" ng-if="selectedChannel">
                    <span class="filter-intro">on</span>
                    <span class="filter label label-default">
                        <span class="content">
                            <img ng-src="/static/img/favicons/{{ selectedChannel.source_name }}.ico">
                            {{ selectedChannel.source_name }}
                        </span>
                        <span class="close-button" ng-click="toggleSelectedChannel(undefined)">&times;</span>
                    </span>
                </span>
            </h3>
            <div class="posts-wrapper"
                 ng-repeat="post in posts | orderBy: '-posted_on' | filter: {source: selectedChannel.source_name} as filteredPosts">

                <div class="post normal"
                     ng-if="$index < d.postsLimit"
                     ng-include="'mention-item.tpl.html'"></div>
                <div class="post tweet"></div>
            </div>

            <div class="more">
                <span class="btn btn-default btn-sm"
                      ng-click="d.postsLimit = d.postsLimit + 10"
                      ng-show="d.postsLimit < filteredPosts.length">
                    <i class="fa fa-arrow-down"></i>
                    See more
                </span>
            </div>

        </div>

        <div class="col-md-4 score-col small-col">
            <h4>Filter by channel</h4>
            <div class="channels-list-wrapper" ng-include="'channels-list.tpl.html'"></div>

        </div>
    </div>






    <div class="row person-footer">
        <div class="text col-md-8">
            This page uses open data (yay!) from
            <a href="http://orcid.org/{{ person.orcid_id }}">{{ person.given_names }} {{ person.family_name }}'s ORCID profile</a>,
            and metrics from
            <a href="http://altmetric.com">Altmetric.com.</a>
            <span class="text">
                All the data you see here is open for re-use.
            </span>
        </div>
        <div class="buttons col-md-4">
            <a class="btn btn-xs btn-default"
               target="_self"
               href="/api/person/{{ person.orcid_id }}">
                <i class="fa fa-cogs"></i>
                view as JSON
            </a>
        </div>

    </div>

</div>

